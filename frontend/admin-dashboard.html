<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏•‡∏∞ PM2.5</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        input { margin: 5px; padding: 8px; }
        button { padding: 10px; background-color: #28a745; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #218838; }
        canvas { max-width: 600px; margin-top: 20px; }
        .chart-container { display: flex; flex-wrap: wrap; justify-content: center; }
        .chart-box { margin: 20px; }
    </style>
</head>
<body>

    <h2>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏•‡∏∞ PM2.5</h2>
    
    üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <input type="date" id="date">
    üìç ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î: <input type="text" id="province" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø">
    üå°Ô∏è ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C): <input type="number" id="temperature" placeholder="‡πÄ‡∏ä‡πà‡∏ô 30">
    üå´Ô∏è PM2.5 (¬µg/m¬≥): <input type="number" id="pm25" placeholder="‡πÄ‡∏ä‡πà‡∏ô 50">
    <button onclick="addData()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>

    <div class="chart-container" id="charts"></div>
    <button id="logoutButton">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>

<script>
    document.getElementById("logoutButton").addEventListener("click", function () {
        sessionStorage.removeItem("isAdminLoggedIn");
        window.location.href = "login.html";
    });

    let provinceData = {};

    function addData() {
        let date = document.getElementById("date").value;
        let province = document.getElementById("province").value;
        let temperature = document.getElementById("temperature").value;
        let pm25 = document.getElementById("pm25").value;

        if (date && province && temperature && pm25) {
            if (!provinceData[province]) {
                provinceData[province] = { labels: [], datasets: [
                    { label: "PM2.5 (¬µg/m¬≥)", data: [], backgroundColor: "blue" },
                    { label: "‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)", data: [], backgroundColor: "red" }
                ] };
                createChart(province);
            }
            
            provinceData[province].labels.push(date);
            provinceData[province].datasets[0].data.push(parseFloat(pm25));
            provinceData[province].datasets[1].data.push(parseFloat(temperature));
            updateChart(province);
        } else {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö!");
        }
    }

    function createChart(province) {
        let chartContainer = document.getElementById("charts");
        let chartBox = document.createElement("div");
        chartBox.classList.add("chart-box");
        chartBox.innerHTML = `<h3>${province}</h3><canvas id="chart-${province}"></canvas>`;
        chartContainer.appendChild(chartBox);

        let ctx = document.getElementById(`chart-${province}`).getContext("2d");
        provinceData[province].chart = new Chart(ctx, {
            type: "bar",
            data: provinceData[province],
            options: { 
                responsive: true,
                scales: { 
                    x: { title: { display: true, text: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà" } },
                    y: { title: { display: true, text: "‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ / PM2.5" } } 
                }
            }
        });
    }

    function updateChart(province) {
        provinceData[province].chart.update();
    }

    document.addEventListener("DOMContentLoaded", function () {
        const isAdminLoggedIn = sessionStorage.getItem("isAdminLoggedIn");
        if (!isAdminLoggedIn || isAdminLoggedIn !== "true") {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ");
            window.location.href = "admin-login.html";
        }
    });
</script>
</body>
</html>
